# Stage 1: Build the React application
FROM node:18-alpine AS builder

WORKDIR /app

# [수정됨] package-lock.json 대신 package.json만 먼저 복사합니다.
# 이렇게 하면 package.json이 변경되지 않았을 때 Docker가 캐시를 재사용하여 속도를 높입니다.
COPY package.json ./

# [수정됨] 'npm ci' 대신 'npm install'을 사용하여 의존성을 설치합니다.
# 'npm install'은 환경 차이에 대해 더 유연하게 작동합니다.
RUN npm install

# Copy all source code
COPY . .

# React 애플리케이션을 빌드합니다.
RUN npm run build

# Stage 2: Serve the React application with Nginx
FROM nginx:alpine

# Remove default Nginx configuration
RUN rm /etc/nginx/conf.d/default.conf

# Copy React build output to Nginx's public directory
COPY --from=builder /app/build /usr/share/nginx/html

# Expose port 80 for Nginx
EXPOSE 80

# Start Nginx
CMD ["nginx", "-g", "daemon off;"]

