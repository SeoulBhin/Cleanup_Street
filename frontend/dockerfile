# Stage 1: Build the React application
FROM node:18-alpine AS builder

WORKDIR /app

# Copy package.json and yarn.lock (or package-lock.json) for dependency caching
# ğŸ’¡ ìºì‹±ì„ í™œìš©í•˜ì—¬ ë¹Œë“œ ì†ë„ë¥¼ ë†’ì…ë‹ˆë‹¤.
COPY package.json ./
COPY yarn.lock ./

# Install dependencies
RUN yarn install --frozen-lockfile

# Copy all source code
COPY . .

# Build the React application for production
# ğŸ’¡ 'build' í´ë”ì— ìµœì¢… ë¹Œë“œ ê²°ê³¼ë¬¼ì´ ìƒì„±ë©ë‹ˆë‹¤.
RUN yarn build

# Stage 2: Serve the React application with Nginx
FROM nginx:alpine

# Remove default Nginx configuration (ì„ íƒ ì‚¬í•­: ì‚¬ìš©ì ì •ì˜ ì„¤ì •ìœ¼ë¡œ êµì²´í•  ê²½ìš°)
RUN rm /etc/nginx/conf.d/default.conf

# Copy React build output to Nginx's public directory
COPY --from=builder /app/build /usr/share/nginx/html

# (Optional) Copy custom Nginx configuration if you have one
# ğŸ’¡ Nginxë¥¼ í†µí•´ React ì•±ì„ ì„œë¹™í•˜ëŠ” ì„¤ì • íŒŒì¼ì´ í•„ìš”í•˜ë©´ ì´ê³³ì— ë³µì‚¬í•©ë‹ˆë‹¤.
# COPY nginx.conf /etc/nginx/conf.d/default.conf

# Expose port 80 for Nginx (ì»¨í…Œì´ë„ˆ ë‚´ë¶€ Nginx í¬íŠ¸)
EXPOSE 80

# Start Nginx
CMD ["nginx", "-g", "daemon off;"]